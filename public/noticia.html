<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="./css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
</head>
<body onload="obterDadosGrafico()">
    <div id="nav" class="navBar">
        <img src="./assets/imagens/logo.png">
        <ul class="container">
            <li class="navItem"><a href="index.html" class="navLink">Início</a></li>
            <li class="navItem"><a href="sobremim.html" class="navLink">Sobre mim</a></li>
            <li class="navItem"><a href="dashboard.html" class="navLink">Feedback</a></li>
            <li class="navItem"><a href="cruzada.html" class="navLink">Jogo</a></li>
            <li class="navItem"><a href="noticia.html" class="navLink">Notícias</a></li>
        </ul>
    </div>
    <div id="nav" class="navBar">
        <img src="./assets/imagens/logo.png">
        <ul class="container">
            <li class="navItem"><a href="#meus-feedbacks">Meus Feedbacks</a></li>
            <li class="navItem"><a href="#feedbacks-favoritados">Feedbacks Favoritados</a></li>
            <li class="navItem"><a href="#settings">Configurações</a></li>
            <li class="navItem"><a href="#" onclick="logout()">Sair</a></li>
        </ul>
    </div>
    <div id="content">
        <section id="meusFeedbacks">
            <h2>Meus Feedbacks</h2>
            <canvas id="meusFeedbacksChart"></canvas>
        </section>
        <section id="feedbacksFavoritos">
            <h2>Feedbacks Favoritos</h2>
            <canvas id="feedbacksFavoritosChart"></canvas>
        </section>
    </div>
</body> 
</html>
<script>
    var idUsuario = sessionStorage.ID_USUARIO;

function obterDadosGrafico() {
fetch(`/favorito/${idUsuario}`, { cache: 'no-store' }).then(function (response) {
    if (response.ok) {
        response.json().then(function (resposta) {
            console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
            resposta.reverse();

            plotarGrafico(resposta);

        });
    } else {
        console.error('Nenhum dado encontrado ou erro na API');
    }
})
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}

function plotarGrafico(resposta) {

console.log('iniciando plotagem do gráfico...');

// Criando estrutura para plotar gráfico - labels
let labels = [];

// Criando estrutura para plotar gráfico - dados
let dados = {
    labels: labels,
    datasets: [{
        label: 'qtde',
        data: [],
        fill: false,
        borderColor: 'rgb(75, 192, 192)',
        tension: 0.1
    }]
};

console.log('----------------------------------------------')
console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
console.log(resposta)

// Inserindo valores recebidos em estrutura para plotar o gráfico
for (i = 0; i < resposta.length; i++) {
    var registro = resposta[i];
    labels.push(registro.momento_grafico);
    dados.datasets[0].data.push(registro.qtde);
}

console.log('----------------------------------------------')
console.log('O gráfico será plotado com os respectivos valores:')
console.log('Labels:')
console.log(labels)
console.log('Dados:')
console.log(dados.datasets)
console.log('----------------------------------------------')

// Criando estrutura para plotar gráfico - config
const config = {
    type: 'bar',
    data: dados,
};

// Adicionando gráfico criado em div na tela
let myChart = new Chart(
    document.querySelector("#feedbacksFavoritosChart"),
    config
);

// setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
}


// function obterDadosGrafico() {
// fetch(`/feedback/${idUsuario}`, { cache: 'no-store' }).then(function (response) {
//     if (response.ok) {
//         response.json().then(function (resposta) {
//             console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
//             resposta.reverse();

//             plotarGrafico(resposta);

//         });
//     } else {
//         console.error('Nenhum dado encontrado ou erro na API');
//     }
// })
//     .catch(function (error) {
//         console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
//     });
// }

// function plotarGrafico(resposta) {

// console.log('iniciando plotagem do gráfico...');

// // Criando estrutura para plotar gráfico - labels
// let labels = [];

// // Criando estrutura para plotar gráfico - dados
// let dados = {
//     labels: labels,
//     datasets: [{
//         label: 'qtde',
//         data: [],
//         fill: false,
//         borderColor: 'rgb(75, 192, 192)',
//         tension: 0.1
//     }]
// };

// console.log('----------------------------------------------')
// console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
// console.log(resposta)

// // Inserindo valores recebidos em estrutura para plotar o gráfico
// for (i = 0; i < resposta.length; i++) {
//     var registro = resposta[i];
//     labels.push(registro.momento_grafico);
//     dados.datasets[0].data.push(registro.qtde);
// }

// console.log('----------------------------------------------')
// console.log('O gráfico será plotado com os respectivos valores:')
// console.log('Labels:')
// console.log(labels)
// console.log('Dados:')
// console.log(dados.datasets)
// console.log('----------------------------------------------')

// // Criando estrutura para plotar gráfico - config
// const config = {
//     type: 'line',
//     data: dados,
// };

// // Adicionando gráfico criado em div na tela
// let myChart = new Chart(
//     document.querySelector("#meus-feedbacks"),
//     config
// );

// // setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
// }




function logout() {
    sessionStorage.clear();
    window.location.href = 'index.html';
}
    // O gráfico é construído com três funções:
    // 1. obterDadosGrafico -> Traz dados do Banco de Dados para montar o gráfico da primeira vez
    // 2. plotarGrafico -> Monta o gráfico com os dados trazidos e exibe em tela
    // 3. atualizarGrafico -> Atualiza o gráfico, trazendo novamente dados do Banco
   
</script>